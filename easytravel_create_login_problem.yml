---
- name: Login to OpenShift cluster
  hosts: all
  connection: ssh
  tasks:
    - name: Get access token  
      k8s_auth:  
        username: {{openshift_user}}
        password: {{openshift_pwd}}
        host: {{openshift_api_url}}
        validate_certs: true 
      register: k8s_auth_results
    - name: Create a namespace with token  
      k8s:  
        api_key: "{{ k8s_auth_results.k8s_auth.api_key }}"  
        name: testnamespace
        kind: Namespace  
        state: present
    #- name: Login to OpenShift cluster
      #command: oc login -u {{openshift_user}} -p {{openshift_pwd}} --insecure-skip-tls-verify {{openshift_api_url}}
    #- name: Set environment variable for deployment config
      #command: oc set env dc/easytravel-loadgen ET_BACKEND_URL=http://easytravel-www:8080 ET_PROBLEMS=LoginProblems -n easytravel
